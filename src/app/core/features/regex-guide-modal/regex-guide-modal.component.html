<mat-horizontal-stepper linear #stepper>
  <mat-step [stepControl]="introForm">
    <form [formGroup]="introForm" i18n-aria-label="@@introFormAriaLabel" aria-label="Introdu√ß√£o ao guia de regex">
      <ng-template matStepLabel></ng-template>
      
      <h2 i18n="@@introTitle">Bem-vindo ao Guia Interativo de Regex</h2>
      <p i18n="@@introP1">
        Este guia vai te ajudar a aprender o b√°sico de Express√µes Regulares
        (Regex), uma ferramenta poderosa para validar e manipular textos.
      </p>
      <p i18n="@@introP2">Vamos come√ßar?</p>

      <p i18n="@@quizTitle"><strong>Voc√™ j√° usou Regex antes?</strong></p>
      <mat-radio-group
        formControlName="usedRegex"
        i18n-aria-label="@@quizAriaLabel"
        aria-label="Quiz: voc√™ j√° usou Regex antes?"
      >
        <mat-radio-button i18n="@@radioSim" value="sim">Sim</mat-radio-button>
        <mat-radio-button i18n="@@radioNao" value="n√£o">N√£o</mat-radio-button>
      </mat-radio-group>

      <div class="step-buttons">
        <button
          mat-button
          matStepperNext
          [disabled]="!introForm.valid"
          i18n-aria-label="@@btnNextAriaLabel"
          aria-label="Pr√≥ximo passo"
        >
          <span i18n="@@btnNext">Pr√≥ximo</span>
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="oQueEForm">
    <form [formGroup]="oQueEForm" i18n-aria-label="@@oQueEFormAriaLabel" aria-label="O que √© Regex?">
      <ng-template matStepLabel></ng-template>
      <h2 i18n="@@oQueETitle">O que √© uma Express√£o Regular?</h2>
      <p i18n="@@oQueEP1">
        Pense em Regex como um "super-poder" para encontrar e manipular textos.
        √â um padr√£o que voc√™ cria para "ca√ßar" informa√ß√µes em frases, documentos
        ou c√≥digos.
      </p>

      <div class="visual-explanation">
        <div class="circle-card">
          <span class="icon">üìß</span>
          <p i18n="@@cardEmail">Validar e-mails</p>
        </div>
        <div class="circle-card">
          <span class="icon">üìû</span>
          <p i18n="@@cardPhone">Encontrar telefones</p>
        </div>
        <div class="circle-card">
          <span class="icon">üîç</span>
          <p i18n="@@cardSearch">Procurar palavras</p>
        </div>
      </div>

      <mat-checkbox
        formControlName="understoodConcept"
        i18n-aria-label="@@understoodConceptAriaLabel"
        aria-label="Checkbox para confirmar entendimento do conceito"
        i18n="@@understoodConcept"
        >Entendi a ideia</mat-checkbox
      >

      <div class="step-buttons">
        <button mat-button matStepperPrevious i18n-aria-label="@@btnBackAriaLabel" aria-label="Voltar passo">
          <span i18n="@@btnBack">Voltar</span>
        </button>
        <button
          mat-button
          matStepperNext
          [disabled]="!oQueEForm.valid"
          i18n-aria-label="@@btnNextAriaLabel"
          aria-label="Pr√≥ximo passo"
        >
          <span i18n="@@btnNext">Pr√≥ximo</span>
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="lendoRegexForm">
    <form
      [formGroup]="lendoRegexForm"
      i18n-aria-label="@@lendoRegexFormAriaLabel"
      aria-label="Lendo a sintaxe b√°sica de regex"
    >
      <ng-template matStepLabel></ng-template>
      <h2 i18n="@@lendoRegexTitle">O Alfabeto da Regex</h2>
      <p i18n="@@lendoRegexP1">Aprenda o significado dos caracteres mais comuns:</p>

      <div class="guide-grid">
        <div
          class="expandable-card"
          *ngFor="let item of syntaxGuide"
          [class.expanded]="item.expanded"
          (click)="toggleCard(item, syntaxGuide)"
        >
          <div class="card-header">
            <div class="pattern-box">
              <code>{{ item.pattern }}</code>
            </div>
            <p class="description">{{ item.description }}</p>
            <div class="toggle-icon">‚ñº</div>
          </div>

          <div class="card-content">
            <div class="example-box">
              <p i18n="@@lendoRegexExampleText">Exemplo:</p>
              <div class="example-text" [innerHTML]="item.example"></div>
            </div>
          </div>
        </div>
      </div>

      <mat-checkbox
        formControlName="understoodReading"
        i18n-aria-label="@@understoodReadingAriaLabel"
        aria-label="Checkbox para confirmar entendimento da sintaxe"
        i18n="@@understoodReading"
        >Entendi a sintaxe</mat-checkbox
      >

      <div class="step-buttons">
        <button mat-button matStepperPrevious i18n-aria-label="@@btnBackAriaLabel" aria-label="Voltar passo">
          <span i18n="@@btnBack">Voltar</span>
        </button>
        <button
          mat-button
          matStepperNext
          [disabled]="!lendoRegexForm.valid"
          i18n-aria-label="@@btnNextAriaLabel"
          aria-label="Pr√≥ximo passo"
        >
          <span i18n="@@btnNext">Pr√≥ximo</span>
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="quantificadoresForm">
    <form
      [formGroup]="quantificadoresForm"
      i18n-aria-label="@@quantificadoresFormAriaLabel"
      aria-label="Entendendo quantificadores em regex"
    >
      <ng-template matStepLabel></ng-template>
      <h2 i18n="@@quantificadoresTitle">Quantificadores</h2>
      <p i18n="@@quantificadoresP1">Eles dizem "quantas vezes" um padr√£o se repete:</p>

      <div class="guide-grid">
        <div
          class="expandable-card"
          *ngFor="let item of quantifierGuide"
          [class.expanded]="item.expanded"
          (click)="toggleCard(item, quantifierGuide)"
        >
          <div class="card-header">
            <div class="pattern-box">
              <code>{{ item.pattern }}</code>
            </div>
            <p class="description">{{ item.description }}</p>
            <div class="toggle-icon">‚ñº</div>
          </div>

          <div class="card-content">
            <div class="example-box">
              <p i18n="@@quantificadoresExampleText">Exemplo:</p>
              <div class="example-text" [innerHTML]="item.example"></div>
            </div>
          </div>
        </div>
      </div>

      <mat-checkbox
        formControlName="understoodQuantifiers"
        i18n-aria-label="@@understoodQuantifiersAriaLabel"
        aria-label="Checkbox para confirmar entendimento dos quantificadores"
        i18n="@@understoodQuantifiers"
        >Entendi os quantificadores</mat-checkbox
      >

      <div class="step-buttons">
        <button mat-button matStepperPrevious i18n-aria-label="@@btnBackAriaLabel" aria-label="Voltar passo">
          <span i18n="@@btnBack">Voltar</span>
        </button>
        <button
          mat-button
          matStepperNext
          [disabled]="!quantificadoresForm.valid"
          i18n-aria-label="@@btnNextAriaLabel"
          aria-label="Pr√≥ximo passo"
        >
          <span i18n="@@btnNext">Pr√≥ximo</span>
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="geradorForm">
    <form [formGroup]="geradorForm" i18n-aria-label="@@geradorFormAriaLabel" aria-label="Usando o gerador de regex">
      <ng-template matStepLabel></ng-template>
      <h2 i18n="@@geradorTitle">Usando o Gerador</h2>
      <p i18n="@@geradorP1">
        Agora que voc√™ conhece o b√°sico, use a se√ß√£o Gerador Guiado na tela
        principal para criar regex.
      </p>
      <p i18n="@@geradorP2">
        Selecione um padr√£o (e-mail, CPF, etc.) e veja a regex gerada, com
        explica√ß√µes detalhadas.
      </p>

      <mat-checkbox
        formControlName="understoodGenerator"
        i18n-aria-label="@@understoodGeneratorAriaLabel"
        aria-label="Checkbox para confirmar entendimento do gerador"
        i18n="@@understoodGenerator"
        >Entendi como usar o Gerador</mat-checkbox
      >

      <div class="step-buttons">
        <button mat-button matStepperPrevious i18n-aria-label="@@btnBackAriaLabel" aria-label="Voltar passo">
          <span i18n="@@btnBack">Voltar</span>
        </button>
        <button
          mat-button
          matStepperNext
          [disabled]="!geradorForm.valid"
          i18n-aria-label="@@btnNextAriaLabel"
          aria-label="Pr√≥ximo passo"
        >
          <span i18n="@@btnNext">Pr√≥ximo</span>
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="testadorForm">
    <form [formGroup]="testadorForm" i18n-aria-label="@@testadorFormAriaLabel" aria-label="Usando o testador de regex">
      <ng-template matStepLabel></ng-template>
      <h2 i18n="@@testadorTitle">Usando o Testador</h2>
      <p i18n="@@testadorP1">
        Depois de gerar sua regex, cole qualquer texto e a ferramenta ir√°
        validar se ele corresponde ao padr√£o.
      </p>
      <p i18n="@@testadorP2">
        Voc√™ ver√° se o texto √© v√°lido (‚úÖ) ou inv√°lido (‚ùå).
      </p>

      <mat-checkbox
        formControlName="understoodTester"
        i18n-aria-label="@@understoodTesterAriaLabel"
        aria-label="Checkbox para confirmar entendimento do testador"
        i18n="@@understoodTester"
        >Entendi como usar o Testador</mat-checkbox
      >

      <div class="step-buttons">
        <button mat-button matStepperPrevious i18n-aria-label="@@btnBackAriaLabel" aria-label="Voltar passo">
          <span i18n="@@btnBack">Voltar</span>
        </button>
        <button
          mat-button
          matStepperNext
          [disabled]="!testadorForm.valid"
          i18n-aria-label="@@btnNextAriaLabel"
          aria-label="Pr√≥ximo passo"
        >
          <span i18n="@@btnNext">Pr√≥ximo</span>
        </button>
      </div>
    </form>
  </mat-step>

  <mat-step [stepControl]="praticaForm">
    <form [formGroup]="praticaForm" i18n-aria-label="@@praticaFormAriaLabel" aria-label="Pr√°tica com regex de e-mail">
      <ng-template matStepLabel></ng-template>
      <h2 i18n="@@praticaTitle">Pr√°tica: Valida√ß√£o de e-mail</h2>
      <p i18n="@@praticaP1">Tente digitar um e-mail que combine com esta regex:</p>
      <p i18n="@@praticaP2">
        <strong>Regex de e-mail:</strong> <code>{{ emailRegex }}</code>
      </p>
      <mat-form-field appearance="fill">
        <mat-label i18n="@@praticaInputLabel">Digite um e-mail v√°lido</mat-label>
        <input
          matInput
          formControlName="practiceAnswer"
          placeholder="exemplo@dominio.com"
          aria-describedby="emailHelp"
        />
        <mat-error
          *ngIf="
            praticaForm.get('practiceAnswer')?.invalid &&
            praticaForm.get('practiceAnswer')?.touched
          "
          i18n="@@praticaErrorMsg"
        >
          Formato de e-mail inv√°lido
        </mat-error>
      </mat-form-field>
      <small id="emailHelp" class="email-help-text" i18n="@@praticaSmallText">
        Exemplo: {{ emailExample }}
      </small>

      <div class="feedback" aria-live="polite" style="margin-top: 1em">
        <span *ngIf="praticaForm.valid">
          <strong
            *ngIf="checkPractice(); else wrong"
            i18n="@@praticaResultCorrect"
          >
            Resultado: Correto ‚úîÔ∏è
          </strong>
          <ng-template #wrong>
            <span style="color: red" i18n="@@praticaResultWrong">
              Resultado: N√£o corresponde ‚ùå
            </span>
          </ng-template>
        </span>
      </div>

      <div class="step-buttons">
        <button mat-button matStepperPrevious i18n-aria-label="@@btnBackAriaLabel" aria-label="Voltar passo">
          <span i18n="@@btnBack">Voltar</span>
        </button>
        <button
          mat-button
          (click)="closeModal()"
          [disabled]="!checkPractice()"
          i18n-aria-label="@@btnFinishAriaLabel"
          aria-label="Finalizar guia"
        >
          <span i18n="@@btnFinish">Finalizar</span>
        </button>
      </div>
    </form>
  </mat-step>
</mat-horizontal-stepper>